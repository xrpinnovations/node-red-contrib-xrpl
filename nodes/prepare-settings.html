<script type="text/x-red" data-template-name="prepare-settings">
    <div class="form-row" title="Custom name to apply to this node">
        <label for="name"><i class="fa fa-tag"></i> Node Name</label>
        <input type="text" id="node-input-name" placeholder="Node Name">
    </div>

    <div class="form-row">
        <h3>Transaction</h3>
    </div>
    <div class="form-row" title="Which rippled server to connect to? Leaving blank defaults to offline mode">
        <label for="node-input-server"><i class="fa fa-dot-circle-o"></i> Server</label>
        <input type="text" id="node-input-server">
    </div>

    <div class='form-row' title='The address of the account that is creating the transaction.'>
        <label for='node-input-address'><i class='fa fa-tag'></i> Address</label>
        <input type='text' id='node-input-address' placeholder=''>
    </div>

    <!-- -------------------------------------------------------------- -->
    <!-- Add Settings                                                   -->
    <!-- -------------------------------------------------------------- -->
    <div class='form-row'>
        <h3>Settings</h3>
        <div>
            <span>Use these settings with <span style='font-weight:bold;color:red;'>CAUTION!!</span> Read the descriptions first</span>
            <select id="setting-type" style="margin-top: 10px; margin-bottom: 10px; width: 100%;">
            </select>

            <br><br><span id='description'></span><br>

            <div class='form-row' title=''>
                <br>
                <div id='setting-container'>
                </div>
                <br>
            </div>

            <!-- -------------------------------------------------------------- -->
            <!-- Add Signers                                                      -->
            <!-- -------------------------------------------------------------- -->
            <div class="form-row" id="add-signers-container" style='display:none;'>
                <div>
                    <div class='form-row' title='A target number for the signer weights. A multi-signature from this list is valid only if the sum weights of the signatures provided is equal or greater than this value. To delete the signers setting, use the value 0. '>
                        <label for='signers-threshold'><i class='fa fa-tag'></i> Signers Threshold</label>
                        <input type='text' id='signers-threshold' placeholder=''>
                    </div>
                    <div class="form-row" id="add-signers-weight-container">
                        <h5>Add A New Signatory</h5>
                        <div>
                            <div class='form-row' title='An XRP account address '>
                                <label for='signer-address-value'><i class='fa fa-tag'></i> Address</label>
                                <input type='text' id='signer-address-value' placeholder=''>
                            </div>
                            <div class='form-row' title='The weight that the signature of this account counts as towards the threshold. '>
                                <label for='signer-weight-value'><i class='fa fa-tag'></i> Weight</label>
                                <input type='text' id='signer-weight-value' placeholder=''>
                            </div>
                            <!-- Add Signatory Button -->
                            <div class="form-row">
                                <button id="signers-add-btn" style="width: 100%">Add Signatory</button>
                            </div>
                            <!-- Signer List -->
                            <div class="form-row">
                                <ol id="signers-list" style="height: 120px;"></ol>
                            </div>
                        </div>
                    </div>
                </div>
                <br><br>
            </div>
            <!-- -------------------------------------------------------------- -->
            <!-- Add Memos                                                      -->
            <!-- -------------------------------------------------------------- -->
            <div class="form-row" id="add-memo-container">
                <h4>Add A Memo Field</h4>
                <div>
                    <!-- Format Value -->
                    <div class="form-row" title="Optional Conventionally containing information on how the memo is encoded, for example as a MIME type . Only characters allowed in URLs are permitted.">
                        <label for="memo-format-value"><i class="fa fa-tag"></i> Format</label>
                        <input type="text" id="memo-format-value" />
                    </div>

                    <!-- Type Value -->
                    <div class="form-row">
                        <label for="memo-type-value" title="Optional Conventionally, a unique relation (according to RFC 5988 ) that defines the format of this memo. Only characters allowed in URLs are permitted."><i class="fa fa-tag"></i> Type</label>
                        <input type="text" id="memo-type-value" />
                    </div>

                    <!-- Data Value -->
                    <div class="form-row" title="Optional Arbitrary string, conventionally containing the content of the memo.">
                        <label for="memo-data-value"><i class="fa fa-tag"></i> Data</label>
                        <input type="text" id="memo-data-value" />
                    </div>

                    <!-- Add Memo Button -->
                    <div class="form-row">
                        <button id="memo-add-btn" style="width: 100%">Add Memo</button>
                    </div>

                    <!-- Memo List -->
                    <div class="form-row">
                        <ol id="memo-list"></ol>
                    </div>
                </div>
            </div>
        </div>

        <!-- -------------------------------------------------------------- -->
        <!-- Add Instructions                                               -->
        <!-- -------------------------------------------------------------- -->
        <div class="form-row" id="add-instruction-container">
            <h4>Add An Instruction</h4>
            <div>
                <!-- Fee Value -->
                <div class="form-row" title="Optional An exact fee to pay for the transaction. See Transaction Fees for more information.">
                    <label for="instructions-fee"><i class="fa fa-tag"></i> Fee (Drops)</label>
                    <input type="text" id="instructions-fee" />
                </div>

                <!-- Max Ledger Version Value -->
                <div class="form-row" title="Optional The highest ledger version that the transaction can be included in. If this option and maxLedgerVersionOffset are both omitted, the maxLedgerVersion option will default to 3 greater than the current validated ledger version (equivalent to maxLedgerVersionOffset=3). Use null to not set a maximum ledger version.">
                    <label for="instructions-maxLedgerVersion"><i class="fa fa-tag"></i> Max Ledger Version</label>
                    <input type="text" id="instructions-maxLedgerVersion" />
                </div>

                <!-- Max Ledger Version Offset Value -->
                <div class="form-row" title="Optional Offset from current validated ledger version to highest ledger version that the transaction can be included in.">
                    <label for="instructions-maxLedgerVersionOffset"><i class="fa fa-tag"></i> Max Ledger Version Offset</label>
                    <input type="text" id="instructions-maxLedgerVersionOffset" />
                </div>

                <!-- Sequence Value -->
                <div class="form-row" title="Optional The initiating account's sequence number for this transaction.">
                    <label for="instructions-sequence"><i class="fa fa-tag"></i> Sequence</label>
                    <input type="text" id="instructions-sequence" />
                </div>

                <!-- Signers Count Value -->
                <div class="form-row" title="Optional Number of signers that will be signing this transaction.">
                    <label for="instructions-signersCount"><i class="fa fa-tag"></i> Signers Count</label>
                    <input type="text" id="instructions-signersCount" />
                </div>
            </div>
        </div>
    </div>
</script>

<script type="text/x-red" data-help-name="prepare-settings">
    <p>Prepare a settings transaction. The prepared transaction must subsequently be signed and submitted.</p>
    <h3>Inputs</h3>
    <p>
        Set via <b>msg.payload</b>, or set within the node interface.
    </p>
    <dl class="message-properties">
        <dt class='optional'>payload.settings.defaultRipple<span class='property-type'>boolean</span> </dt>
        <dd> Optional Enable rippling on this accountâ€™s trust lines by default. (New in rippled 0.27.3 )</dd>

        <dt class='optional'>payload.settings.depositAuth<span class='property-type'>boolean</span> </dt>
        <dd> Optional Enable Deposit Authorization on this account. If set, transactions cannot send value of any kind to this account unless the sender of those transactions is the account itself. (Requires the DepositAuth amendment )</dd>

        <dt class='optional'>payload.settings.disableMasterKey<span class='property-type'>boolean</span> </dt>
        <dd> Optional Disallows use of the master key to sign transactions for this account. To disable the master key, you must authorize the transaction by signing it with the master key pair. You cannot use a regular key pair or a multi-signature. You can re-enable the master key pair using a regular key pair or multi-signature. See AccountSet .</dd>

        <dt class='optional'>payload.settings.disallowIncomingXRP<span class='property-type'>boolean</span> </dt>
        <dd> Optional Indicates that client applications should not send XRP to this account. Not enforced by rippled.</dd>

        <dt class='optional'>payload.settings.domain<span class='property-type'>string</span> </dt>
        <dd> Optional The domain that owns this account, as a hexadecimal string representing the ASCII for the domain in lowercase.</dd>

        <dt class='optional'>payload.settings.emailHash<span class='property-type'>string,null</span> </dt>
        <dd> Optional Hash of an email address to be used for generating an avatar image. Conventionally, clients use Gravatar to display this image. Type <code>CLEAR</code> to clear.</dd>

        <dt class='optional'>payload.settings.enableTransactionIDTracking<span class='property-type'>boolean</span> </dt>
        <dd> Optional Track the ID of this accountâ€™s most recent transaction.</dd>

        <dt class='optional'>payload.settings.globalFreeze<span class='property-type'>boolean</span> </dt>
        <dd> Optional Freeze all assets issued by this account.</dd>

        <dt class='optional'>payload.settings.memos<span class='property-type'>memos</span> </dt>
        <dd> Optional Array of memos to attach to the transaction.</dd>

        <dt class='optional'>payload.settings.memos.[].data<span class='property-type'>string</span> </dt>
        <dd> Optional Arbitrary string, conventionally containing the content of the memo.</dd>

        <dt class='optional'>payload.settings.memos.[].format<span class='property-type'>string</span> </dt>
        <dd> Optional Conventionally containing information on how the memo is encoded, for example as a MIME type . Only characters allowed in URLs are permitted.</dd>

        <dt class='optional'>payload.settings.memos.[].type<span class='property-type'>string</span> </dt>
        <dd> Optional Conventionally, a unique relation (according to RFC 5988 ) that defines the format of this memo. Only characters allowed in URLs are permitted</dd>

        <dt class='optional'>payload.settings.messageKey<span class='property-type'>string</span> </dt>
        <dd> Optional Public key for sending encrypted messages to this account. Conventionally, it should be a secp256k1 key, the same encryption that is used by the rest of Ripple.</dd>

        <dt class='optional'>payload.settings.noFreeze<span class='property-type'>boolean</span> </dt>
        <dd> Optional Permanently give up the ability to freeze individual trust lines. This flag can never be disabled after being enabled.</dd>

        <dt class='optional'>payload.settings.passwordSpent<span class='property-type'>boolean</span> </dt>
        <dd> Optional Indicates that the account has used its free SetRegularKey transaction.</dd>

        <dt class='optional'>payload.settings.regularKey<span class='property-type'>address,null</span> </dt>
        <dd> Optional The public key of a new keypair, to use as the regular key to this account, as a base-58-encoded string in the same format as an account address. Type <code>CLEAR</code> to remove the regular key.</dd>

        <dt class='optional'>payload.settings.requireAuthorization<span class='property-type'>boolean</span> </dt>
        <dd> Optional If set, this account must individually approve other users in order for those users to hold this accountâ€™s issuances.</dd>

        <dt class='optional'>payload.settings.requireDestinationTag<span class='property-type'>boolean</span> </dt>
        <dd> Optional Requires incoming payments to specify a destination tag.</dd>

        <dt class='optional'>payload.settings.signers<span class='property-type'>object</span> </dt>
        <dd> Optional Settings that determine what sets of accounts can be used to sign a transaction on behalf of this account using multisigning.</dd>

        <dt>payload.settings.signers.threshold<span class='property-type'>integer</span> </dt>
        <dd> A target number for the signer weights. A multi-signature from this list is valid only if the sum weights of the signatures provided is equal or greater than this value. To delete the signers setting, use the value 0.</dd>

        <dt>payload.settings.signers.weights<span class='property-type'>array</span> </dt>
        <dd> Weights of signatures for each signer.</dd>

        <dt>payload.settings.signers.weights[]<span class='property-type'>object</span> </dt>
        <dd> An association of an address and a weight.</dd>

        <dt>payload.settings.signers.weights[].address<span class='property-type'>address</span> </dt>
        <dd> An XRP account address</dd>

        <dt>payload.settings.signers.weights[].weight<span class='property-type'>integer</span> </dt>
        <dd> The weight that the signature of this account counts as towards the threshold.</dd>

        <dt class='optional'>payload.settings.transferRate<span class='property-type'>number,null</span> </dt>
        <dd> Optional The fee to charge when users transfer this accountâ€™s issuances, as the decimal amount that must be sent to deliver 1 unit. Has precision up to 9 digits beyond the decimal point. Type <code>CLEAR</code> to set no fee.</dd>

        <dt class='optional'>payload.instructions<span class='property-type'>instructions</span>
        </dt>
        <dd> Optional Instructions for executing the transaction</dd>
        <dt class='optional'>payload.instructions.fee<span class='property-type'>value</span>
        </dt>
        <dd> Optional An exact fee to pay for the transaction, before multiplying for multi-signed transactions. See Transaction Fees for more information.</dd>
        <dt class='optional'>payload.instructions.maxLedgerVersion<span class='property-type'>integer,null</span>
        </dt>
        <dd> Optional The highest ledger version that the transaction can be included in. If this option and maxLedgerVersionOffset are both omitted, the maxLedgerVersion option will default to 3 greater than the current validated ledger version (equivalent to maxLedgerVersionOffset=3). Use null to not set a maximum ledger version. If not null, this must be an integer greater than 0, or one of the following strings: 'validated', 'closed', 'current'.</dd>
        <dt class='optional'>payload.instructions.maxLedgerVersionOffset<span class='property-type'>integer</span>
        </dt>
        <dd> Optional Offset from current validated ledger version to highest ledger version that the transaction can be included in.</dd>
        <dt class='optional'>payload.instructions.sequence<span class='property-type'>sequence</span>
        </dt>
        <dd> Optional The initiating account's sequence number for this transaction.</dd>
        <dt class='optional'>payload.instructions.signersCount<span class='property-type'>integer</span>
        </dt>
        <dd> Optional Number of signers that will be signing this transaction.</dd>
    </dl>
    <h3>Output</h3>
    <dl class="message-properties">
        <dt>payload.settings.txJSON<span class='property-type'>string</span></dt>
        <dd> The prepared transaction in rippled JSON format.</dd>

        <dt>payload.settings.instructions<span class='property-type'>object</span> </dt>
        <dd> The instructions for how to execute the transaction after adding automatic defaults.</dd>

        <dt>payload.settings.instructions. fee<span class='property-type'>value</span> </dt>
        <dd> The fee to pay for the transaction. See Transaction Fees for more information. For multi-signed transactions, this fee will be multiplied by (N+1), where N is the number of signatures you plan to provide.</dd>

        <dt>payload.settings.instructions. sequence<span class='property-type'>sequence</span> </dt>
        <dd> The initiating account's sequence number for this transaction.</dd>

        <dt>payload.settings.instructions. maxLedgerVersion<span class='property-type'>integer,null</span> </dt>
        <dd> The highest ledger version that the transaction can be included in. Set to null if there is no maximum. If not null, this must be an integer greater than 0, or one of the following strings: 'validated', 'closed', 'current'.</dd>

        <dt>payload.settings.instructions. maxLedgerVersion<span class='property-type'>string,null</span> </dt>
        <dd> The highest ledger version that the transaction can be included in. Set to null if there is no maximum. If not null, this must be an integer greater than 0, or one of the following strings: 'validated', 'closed', 'current</dd>
    </dl>
    <h3>Reference</h3>
    <ul>
        <li><a href='https://xrpl.org/rippleapi-reference.html#preparesettings'>See XRPL Docs</a></li>
    </ul>
</script>

<!-- Finally, the node type is registered along with all of its properties   -->
<script type="text/javascript">

    const settings = {
        defaultRipple:{
            name:'defaultRipple', 
            desc:'Optional Enable rippling  on this accountâ€™s trust lines by default. (New in rippled 0.27.3 )', 
            type:'boolean'
        },
        depositAuth:{
            name:'depositAuth', 
            desc:'Optional Enable Deposit Authorization on this account. If set, transactions cannot send value of any kind to this account unless the sender of those transactions is the account itself. (Requires the DepositAuth amendment )', 
            type:'boolean'
        },
        disableMasterKey:{
            name:'Disable Master Key', 
            desc:'Optional Disallows use of the master key to sign transactions for this account. To disable the master key, you must authorize the transaction by signing it with the master key pair. You cannot use a regular key pair or a multi-signature. You can re-enable the master key pair using a regular key pair or multi-signature. See AccountSet .', 
            type:'boolean'
        },
        disallowIncomingXRP:{
            name:'Disallow Incoming XRP', 
            desc:'Optional Indicates that client applications should not send XRP to this account. Not enforced by rippled.', 
            type:'boolean'
        },
        domain:{
            name:'Domain', 
            desc:'Optional The domain that owns this account, as a hexadecimal string representing the ASCII for the domain in lowercase.', 
            type:'string'
        },
        emailHash:{
            name:'EmailHash (Gravatar)', 
            desc:'Optional Hash of an email address to be used for generating an avatar image. Conventionally, clients use Gravatar to display this image. Type CLEAR to clear.', 
            type:'string'
        },
        enableTransactionIDTracking:{
            name:'Enable Transaction ID Tracking', 
            desc:'Optional Track the ID of this accountâ€™s most recent transaction.', 
            type:'boolean'
        },
        globalFreeze:{
            name:'Global Freeze', 
            desc:'Optional Freeze all assets issued by this account.', 
            type:'boolean'
        },
        messageKey:{
            name:'Message Key', 
            desc:'Optional Public key for sending encrypted messages to this account. Conventionally, it should be a secp256k1 key, the same encryption that is used by the rest of Ripple.', 
            type:'string'
        },
        noFreeze:{
            name:'No Freeze', 
            desc:'Optional Permanently give up the ability to freeze individual trust lines. This flag can never be disabled after being enabled.', 
            type:'boolean'
        },
        passwordSpent:{
            name:'Password Spent', 
            desc:'Optional Indicates that the account has used its free SetRegularKey transaction.', 
            type:'boolean'
        },
        regularKey:{
            name:'Regular Key', 
            desc:'Optional The public key of a new keypair, to use as the regular key to this account, as a base-58-encoded string in the same format as an account address. Type CLEAR to remove the regular key.', 
            type:'string'
        },
        requireAuthorization:{
            name:'Require Authorization', 
            desc:'Optional If set, this account must individually approve other users in order for those users to hold this accountâ€™s issuances.', 
            type:'boolean'
        },
        requireDestinationTag:{
            name:'Require Destination Tag', 
            desc:'Optional Requires incoming payments to specify a destination tag.', 
            type:'boolean'
        },
        transferRate:{
            name:'Transfer Rate', 
            desc:'Optional The fee to charge when users transfer this accountâ€™s issuances, as the decimal amount that must be sent to deliver 1 unit. Has precision up to 9 digits beyond the decimal point. Type CLEAR to set no fee.', 
            type:'string'
        },
        signers:{
            name:'Multi Signing', 
            desc:'Optional Settings that determine what sets of accounts can be used to sign a transaction on behalf of this account using multisigning.',
            type:'signers'
        }
    }

    const settingBool = "<select id='setting'><option value='false'>False</option><option value='true'>True</option></select>";
    const settingText = "<input type='text' id='setting'>";

    function setSettings(){
        $( '#setting-container' ).empty();
        switch (settings[$( '#setting-type' ).val()].type) {
            case 'boolean':
                $( '#setting-container' ).append(settingBool);
                break;
            case 'string':
                $( '#setting-container' ).append(settingText);
                break;  
            case 'signers':
                $( '#add-signers-container' ).css( "display", "block" );
                break; 
                
            default:
                break;
        }
    };

    RED.nodes.registerType('prepare-settings', {
        category: 'XRPL Advanced', // the palette category
        color: "#e2d96e",
        defaults: { // defines the editable properties of the node
            name: {
                value: ""
            },
            server: {
                value: "",
                type: "get-server",
                required: false
            },
            address: {
                value: ""
            },
            settings: {
                value: {}
            },
            instructions: {
                value: {}
            },
        },
        inputs: 1, // set the number of inputs - only 0 or 1
        outputs: 1, // set the number of outputs - 0 to n
        // set the icon (held in icons dir below where you save the node)
        icon: "create.png", // saved in icons/myicon.png
        label: function() { // sets the default label contents
            return this.name || "Prepare Settings";
        },
        labelStyle: function() { // sets the class to apply to the label
            return this.name ? "node_label_italic" : "";
        },
        oneditprepare: function() {
            let node = this;
            
            const $accordionMemo = $("#add-memo-container");
            const $accordionInstructions = $("#add-instruction-container");

            Object.keys(settings).forEach(key => {
                let option = "<option value='" + key + "'>" + settings[key].name + "</option>";
                $( '#setting-type' ).append(option);
            });

            $( '#description' ).text(settings['disableMasterKey'].desc);
            setSettings();

            $( '#setting-type' ).change(function() {
                $( '#description' ).text(settings[$( '#setting-type' ).val()].desc);

                $( '#add-signers-container' ).css( "display", "none" );
                setSettings();

            });

            if (node.settings){
                Object.keys(node.settings).forEach((key)=>{
                    if (key !== 'memos'){
                        $('#setting-type').val(key);
                        setSettings();
                        $('#setting').val(node.settings[key]);
                        $( '#description' ).text(settings[key].desc);
                    }
                });
            }

            const $memos = {
                list: $("#memo-list"),
                addBtn: $("#memo-add-btn"),

                data: $("#memo-data-value"),
                format: $("#memo-format-value"),
                type: $("#memo-type-value")
            };
            const $signers = {
                list: $("#signers-list"),
                addBtn: $("#signers-add-btn"),

                address: $("#signer-address-value"),
                weight: $("#signer-weight-value")
            };

            // **************************
            // * Add Memos
            // **************************
            const memosHandler = {
                onAddMemoButton: function(e) {
                const memo = {
                    data: $memos.data.val(),
                    format: $memos.format.val(),
                    type: $memos.type.val()
                };

                $memos.list.editableList("addItem", memo);
                $memos.data.val("");
                $memos.format.val("");
                $memos.type.val("");
            },
            onEditableListAdd: function(row, index, value) {
                const $row = $(row);
                const {
                    type,
                    format,
                    data
                } = value;

                const rowHtml = `
                <b>Format:</b>&nbsp;${format}<br>
                <b>Type:</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${type}<br>
                <b>Data:</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${data}`;
                $row.html(rowHtml);
            }
            };

            $memos.addBtn.on("click", memosHandler.onAddMemoButton);

            // Memos List
            $memos.list.editableList({
                addButton: false,
                height: 100,
                sortable: true,
                removable: true,
                addItem: memosHandler.onEditableListAdd
            });

            // **************************
            // * Add Signer
            // **************************
            const signersHandler = {
                onAddSignerButton: function(e) {
                    const signer = {
                        address: $signers.address.val(),
                        weight: $signers.weight.val()
                    };

                    $signers.list.editableList("addItem", signer);
                    $signers.address.val("");
                    $signers.weight.val("");
                },
                onEditableListAdd: function(row, index, value) {
                    const $row = $(row);
                    const {
                        address, weight
                    } = value;

                    const rowHtml = `
                    <b>Address:</b>&nbsp;${address}<br>
                    <b>Weight:</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${weight}`;
                    $row.html(rowHtml);
                }
            };

            $signers.addBtn.on("click", signersHandler.onAddSignerButton);

            // signers List
            $signers.list.editableList({
                addButton: false,
                height: 100,
                sortable: true,
                removable: true,
                addItem: signersHandler.onEditableListAdd
            });

            // **************************
            // * General Init
            // **************************
            $accordionMemo.accordion({
                active: true,
                collapsible: true,
                heightStyle: "content"
            });
            $accordionInstructions.accordion({
                active: true,
                collapsible: true,
                heightStyle: "content"
            });

            // Add previous memos to editable lists
            node.settings.memos.forEach(c =>
                $memos.list.editableList("addItem", c)
            );

            // Add previous signers to editable lists
            if (node.settings.signers && node.settings.signers.weights){
                node.settings.signers.weights.forEach(c =>
                    $signers.list.editableList("addItem", c)
                );
            }       

            // add threshold
            if (node.settings.signers){
                $('#signers-threshold').val(node.settings.signers.threshold);
            }   

            $("#instructions-fee").val(node.instructions.fee);
            $("#instructions-maxFee").val(node.instructions.maxFee);
            $("#instructions-maxLedgerVersion").val(node.instructions.maxLedgerVersion);
            $("#instructions-maxLedgerVersion").val(node.instructions.maxLedgerVersion);
            $("#instructions-maxLedgerVersionOffset").val(node.instructions.maxLedgerVersionOffset);
            $("#instructions-sequence").val(node.instructions.sequence);
            $("#instructions-signersCount").val(node.instructions.signersCount);

        },
        oneditsave: function() {
            this.settings = {};
            const $memosList = $("#memo-list");

            // Compile Memos
            const nodeMemos = [];
            const listMemos = $memosList.editableList("items");
            listMemos.each(function(i) {
            nodeMemos.push($(this).data("data"));
            });

            this.settings.memos = nodeMemos;

            const $signersList = $("#signers-list");

            // Compile Signers
            const nodeSigners = [];
            const listSigners = $signersList.editableList("items");

            listSigners.each(function(i) {
                nodeSigners.push($(this).data("data"));
            });

            this.settings[$('#setting-type').val()] = $('#setting').val();

            if ($( '#setting-type' ).val() === 'signers'){
                this.settings.signers = {};
                this.settings.signers.weights = nodeSigners;
                this.settings.signers.threshold = $('#signers-threshold').val();
            }

            this.instructions.fee = $("#instructions-fee").val();
            this.instructions.maxFee = $("#instructions-maxFee").val();
            this.instructions.maxLedgerVersion = $("#instructions-maxLedgerVersion").val();
            this.instructions.maxLedgerVersion = $("#instructions-maxLedgerVersion").val();
            this.instructions.maxLedgerVersionOffset = $("#instructions-maxLedgerVersionOffset").val();
            this.instructions.sequence = $("#instructions-sequence").val();
            this.instructions.signersCount = $("#instructions-signersCount").val();
        }
    });
</script>